<head>
  <title>xpenz</title>

  <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css" rel="stylesheet">

  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>
  </style>
</head>

<body>
	<div class="container">
		<h1 class="text-center">xpenz</h1>
	  {{#if currentUser}}
	  	{{> welcome}}

	  	{{> showUserExpenses}}

	  	{{#if isSuperAccountant}}
	  		{{> showSuperAccountantExpenses }}
	  	{{/if}}

	  {{else}}
	 	 	{{> login}}
	  {{/if}}
	</div>
</body>

<!-- Templates  -->

<template name="login">
	{{ loginMessage }}
	<input id="email" type="email" />
	<input id="password" type="password" />
	<button>Login</button>
</template>

<template name="welcome">
	{{#with currentUser}}
		Hi, {{profile.name}}.
	{{/with}}

	<button type="button" id="logoutButton" class="btn btn-small btn-warning">Logout</button>
</template>

<template name="showUserExpenses">
	<h3>your expenses</h3>
	{{> addNewExpense }}
	
	<div class="row expensesView">
		<table class="table">
			<thead>
				<tr>
					<th>Date</th>
					<th>Type</th>
					<th>Title</th>
					<th>Description</th>
					<th>Amount</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody>
				{{#each getExpenses}}
					<tr>
						<td>{{date}}</td>
						<td>{{type}}</td>
						<td>{{title}}</td>
						<td>{{description}}</td>
						<td>{{amount}}</td>
						<td>{{status}}</td>
						<td>{{#if receiptFileURL}}
							<a href="{{receiptFileURL}}" data-lightbox="image-1" data-title="{{title}}">Receipt</a>
							{{else}}
							{{/if}}</td>
						<td>{{> quickRemoveButton collection=expensesCollection _id=this._id class="btn btn-danger"}}</td>
					</tr>
				{{/each}}
			</tbody>
		</table>
		</div>
</template>

<template name="addNewExpense">
{{ insertError }}
{{#autoForm collection=expenses id="insertExpenseForm" type="insert" class="form-inline"}}
<div class="row">
	
		<div class="col-lg-2">
			{{> afFieldInput name="date" placeholder="schemaLabel" id="expenseDateField"}}
		</div>
		<div class="col-lg-2">
			{{> afFieldInput name="title" placeholder="schemaLabel"}}
		</div>
		<div class="col-lg-2">
			{{> afFieldInput name="description" placeholder="schemaLabel"}}
		</div>
		<div class="col-lg-2">
			{{> afFieldInput name="type" options="allowed"}}
		</div>
		<div class="col-lg-2">
			<div class="input-group">
			  <span class="input-group-addon">$</span>
			  {{> afFieldInput name="amount" placeholder="schemaLabel" step="0.01" type="number" id="expenseAmountField"}}
			</div>
		</div>
		<div class="col-lg-2">
			<input type="file" class="file_bag">
	    {{#each files}}
	        <p>upload: {{percent_uploaded}}%</p>
	    {{/each}}
		</div>
</div>
<div class="row">
	<div class="col-lg-12">
		<button type="submit" class="btn btn-success btn-large" id="createExpenseButton">Create</button>
	</div>
</div>
{{/autoForm}}
</template>

<template name="showSuperAccountantExpenses">
<div class="row expensesView">
	<h3>expenses to approve/reimburse</h3>
	<table class="table">
		<thead>
			<tr>
				<th>Date</th>
				<th>Type</th>
				<th>Title</th>
				<th>Description</th>
				<th>Amount</th>
				<th>Status</th>
			</tr>
		</thead>
		<tbody>
			{{#each getExpenses}}
				{{> displayExpenseRow }}
			{{/each}}
		</tbody>
	</table>
</div>

</template>

<template name="displayExpenseRow">
{{#with currentExpense}}
<tr>
	<td>{{date}}</td>
	<td>{{type}}</td>
	<td>{{title}}</td>
	<td>{{description}}</td>
	<td>{{amount}}</td>
	<td>{{status}}</td>
	<td>{{#if receiptFileURL}}
		<a href="{{receiptFileURL}}" data-lightbox="image-1" data-title="{{title}}">Receipt</a>
		{{else}}
		{{/if}}</td>
	<td>{{#if isPendingApproval}}
		<button type="submit" class="btn btn-primary btn-large approveExpenseButton">Approve</button>
	{{/if}}
	</td>
	<td>{{#if isPendingReimbursement}}
		<button type="submit" class="btn btn-success btn-large reimburseExpenseButton">Pay</button>
	{{/if}}
	</td>

	<td>{{> quickRemoveButton collection=expensesCollection _id=this._id class="btn btn-danger"}}</td>
</tr>
{{/with}}
</template>